<?xml version="1.0" encoding="UTF-8"?>
<pd:ProcessDefinition xmlns:BW="java://com.tibco.pe.core.JavaCustomXPATHFunctions" xmlns:ns="sbv/common/envelope/commonheader/1.0" xmlns:wsdl="http://schemas.xmlsoap.org/wsdl/" xmlns:pfx11="http://www.sbv.gov.vn/global/system/ESB/T24TTBTDT/version1.0/ServiceResponse.xsd" xmlns:pfx10="http://www.tibco.com/schemas/SG31ESBProject/SharedResource/Schema/Global/System/ESB/T24Citad/CitadIn/Schema.xsd" xmlns:pfx5="http://www.sbv.gov.vn/global/system/ESB/T24TTBTDT/version1.0/BTCTUpdateModel.xsd" xmlns:tib="http://www.tibco.com/bw/xslt/custom-functions" xmlns:pfx4="http://temenos.com/SBV.FT.TTBT.PAYMENT.WS" xmlns:pfx3="http://www.sbv.gov.vn/global/system/ESB/T24TTBTDT/version1.0/BTCTPostingESBModel.xsd" xmlns:pfx2="sbv/common/envelope/serviceenvelope/1.0" xmlns:pfx9="sbv/sharedresource/CitadIn/ESBCitadInModel" xmlns:pfx8="http://xmlns.example.com/1438330850951" xmlns:pfx7="http://www.sbv.gov.vn/global/system/ESB/T24TTBTDT/version1.0/NettingResultLine.xsd" xmlns:pfx6="http://www.sbv.gov.vn/global/system/ESB/T24TTBTDT/version1.0/ListNettingResult.xsd" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:ns14="www.tibco.com/plugin/Sleep" xmlns:ns15="http://temenos.com/FTSBVCITAD" xmlns:ns12="sbv/common/logging/enginelog/1.0" xmlns:ns5="http://xmlns.tibco.com/encodings/mime" xmlns:ns13="sbv/common/exceptionhandling/exception/1.0" xmlns:pfx="sbv/common/envelope/soaenvelope/1.0" xmlns:ns2="http://www.tibco.com/pe/DeployedVarsType" xmlns:pd="http://xmlns.tibco.com/bw/process/2003" xmlns:ns1="http://www.sbv.gov.vn/global/system/ESB/T24TTBTDT/version1.0/BTCTPosting.xsd" xmlns:ns4="http://www.tibco.com/namespaces/tnt/plugins/jms" xmlns:ns3="http://www.tibco.com/pe/EngineTypes" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <xsd:import namespace="sbv/common/envelope/soaenvelope/1.0" schemaLocation="/SharedResource/Schema/Common/Envelope/SOAEnvelope.xsd"/>
    <xsd:import namespace="sbv/common/envelope/serviceenvelope/1.0" schemaLocation="/SharedResource/Schema/Common/Envelope/ServiceEnvelope.xsd"/>
    <xsd:import namespace="http://www.sbv.gov.vn/global/system/ESB/T24TTBTDT/version1.0/NettingResultLine.xsd" schemaLocation="/SharedResource/Schema/Global/System/ESB/T24TTBTDT/BTCTPosting/NettingResultLine.xsd"/>
    <xsd:import namespace="http://www.sbv.gov.vn/global/system/ESB/T24TTBTDT/version1.0/BTCTPostingESBModel.xsd" schemaLocation="/SharedResource/Schema/Global/System/ESB/T24TTBTDT/BTCTPosting/BTCTPostingESBModel.xsd"/>
    <xsd:import namespace="http://www.sbv.gov.vn/global/system/ESB/T24TTBTDT/version1.0/BTCTUpdateModel.xsd" schemaLocation="/SharedResource/Schema/Global/System/ESB/T24TTBTDT/BTCTPosting/BTCTUpdateModel.xsd"/>
    <xsd:import namespace="http://www.sbv.gov.vn/global/system/ESB/T24TTBTDT/version1.0/ServiceResponse.xsd" schemaLocation="/SharedResource/Schema/Global/System/ESB/T24TTBTDT/BTCTPosting/ServiceResponse.xsd"/>
    <xsd:import namespace="http://www.sbv.gov.vn/global/system/ESB/T24TTBTDT/version1.0/BTCTPosting.xsd" schemaLocation="/SharedResource/Schema/Global/System/ESB/T24TTBTDT/BTCTPosting/BTCTPosting.xsd"/>
    <xsd:import namespace="http://temenos.com/SBV.FT.TTBT.PAYMENT.WS"/>
    <xsd:import namespace="http://temenos.com/SBV.FT.TTBT.PAYMENT.WS" schemaLocation="/SharedResource/Schema/Global/System/T24/TTBTDT/BTCTPosting/SBV.FT.TTBT.PAYMENT.WS_xsd1.xsd"/>
    <wsdl:import namespace="http://temenos.com/SBV.FT.TTBT.PAYMENT.WS" location="/SharedResource/Schema/Global/System/T24/TTBTDT/BTCTPosting/SBV.FT.TTBT.PAYMENT.WS.wsdl"/>
    <pd:name>Services/Global/System/T24TTBTDT/BTCTPosting/Version1.0/BTCTPosting/RequestResponse_bk.process</pd:name>
    <pd:description>Author: tuedn</pd:description>
    <pd:startName>Start</pd:startName>
    <pd:startType>
        <xs:element xmlns:xs="http://www.w3.org/2001/XMLSchema" name="root">
            <xs:complexType>
                <xs:sequence>
                    <xs:element ref="pfx2:ServiceEnverlop"/>
                </xs:sequence>
            </xs:complexType>
        </xs:element>
    </pd:startType>
    <pd:startX>88</pd:startX>
    <pd:startY>50</pd:startY>
    <pd:returnBindings>
        <root>
            <pfx2:ServiceEnverlop>
                <ns:AppHdr>
                    <xsl:if test="$Start/root/pfx2:ServiceEnverlop/ns:AppHdr/ns:CharSet">
                        <ns:CharSet>
                            <xsl:value-of select="$Start/root/pfx2:ServiceEnverlop/ns:AppHdr/ns:CharSet"/>
                        </ns:CharSet>
                    </xsl:if>
                    <ns:ServVersion>
                        <xsl:value-of select="$Start/root/pfx2:ServiceEnverlop/ns:AppHdr/ns:ServVersion"/>
                    </ns:ServVersion>
                    <ns:From>
                        <ns:Id>
                            <xsl:value-of select="$Start/root/pfx2:ServiceEnverlop/ns:AppHdr/ns:From/ns:Id"/>
                        </ns:Id>
                        <ns:Name>
                            <xsl:value-of select="$Start/root/pfx2:ServiceEnverlop/ns:AppHdr/ns:From/ns:Name"/>
                        </ns:Name>
                    </ns:From>
                    <ns:To>
                        <ns:Id>
                            <xsl:value-of select="$Start/root/pfx2:ServiceEnverlop/ns:AppHdr/ns:To/ns:Id"/>
                        </ns:Id>
                        <ns:Name>
                            <xsl:value-of select="$Start/root/pfx2:ServiceEnverlop/ns:AppHdr/ns:To/ns:Name"/>
                        </ns:Name>
                    </ns:To>
                    <ns:MsgId>
                        <xsl:value-of select="$PostToT24_SettleTTBT/outputMessage/pfx4:SettleTTBTResponse/Status/transactionId"/>
                    </ns:MsgId>
                    <ns:MsgPreId>
                        <xsl:value-of select="$Start/root/pfx2:ServiceEnverlop/ns:AppHdr/ns:MsgId"/>
                    </ns:MsgPreId>
                    <xsl:if test="$Start/root/pfx2:ServiceEnverlop/ns:AppHdr/ns:MsgSrcId">
                        <ns:MsgSrcId>
                            <xsl:value-of select="$Start/root/pfx2:ServiceEnverlop/ns:AppHdr/ns:MsgSrcId"/>
                        </ns:MsgSrcId>
                    </xsl:if>
                    <ns:BizServ>
                        <ns:Id>
                            <xsl:value-of select="$Start/root/pfx2:ServiceEnverlop/ns:AppHdr/ns:BizServ/ns:Id"/>
                        </ns:Id>
                        <ns:Name>
                            <xsl:value-of select="$Start/root/pfx2:ServiceEnverlop/ns:AppHdr/ns:BizServ/ns:Name"/>
                        </ns:Name>
                    </ns:BizServ>
                    <ns:CreatedDate>
                        <xsl:value-of select="$Start/root/pfx2:ServiceEnverlop/ns:AppHdr/ns:CreatedDate"/>
                    </ns:CreatedDate>
                    <xsl:if test="$Start/root/pfx2:ServiceEnverlop/ns:AppHdr/ns:Signature">
                        <ns:Signature>
                            <xsl:value-of select="$Start/root/pfx2:ServiceEnverlop/ns:AppHdr/ns:Signature"/>
                        </ns:Signature>
                    </xsl:if>
                </ns:AppHdr>
                <ns:ResponseStatus>
                    <ns:Status>
                        <xsl:value-of select="if ($ServiceResponse/ServiceResponse/pfx11:ServiceResponse/pfx11:Status = 0 )&#xA;then 0&#xA;else 1"/>
                    </ns:Status>
                    <xsl:if test="$ServiceResponse/ServiceResponse/pfx11:ServiceResponse/pfx11:Status">
                        <ns:ErrorCode>
                            <xsl:value-of select="$ServiceResponse/ServiceResponse/pfx11:ServiceResponse/pfx11:Status"/>
                        </ns:ErrorCode>
                    </xsl:if>
                    <ns:ErrorMessage>
                        <xsl:value-of select="$ServiceResponse/ServiceResponse/pfx11:ServiceResponse/pfx11:ErrorMessage"/>
                    </ns:ErrorMessage>
                </ns:ResponseStatus>
                <ServiceBody>
                    <xsl:copy-of select="$Map-to-T24-Request/pfx4:SettleTTBT"/>
                    <xsl:copy-of select="$PostToT24_SettleTTBT/outputMessage/pfx4:SettleTTBTResponse"/>
                    <xsl:copy-of select="$UpdateSuccess/jdbcUpdateActivityOutput"/>
                    <xsl:copy-of select="$UpdateLogicError/jdbcUpdateActivityOutput"/>
                    <xsl:copy-of select="$UpdateExistStatus/jdbcUpdateActivityOutput"/>
                    <xsl:copy-of select="$UpdateErrorOnly/jdbcUpdateActivityOutput"/>
                    <xsl:copy-of select="$UpdateErrorOnly/jdbcUpdateActivityOutput"/>
                </ServiceBody>
            </pfx2:ServiceEnverlop>
        </root>
    </pd:returnBindings>
    <pd:endName>End</pd:endName>
    <pd:endType>
        <xsd:element name="root">
            <xsd:complexType>
                <xsd:sequence>
                    <xsd:element ref="pfx2:ServiceEnverlop"/>
                </xsd:sequence>
            </xsd:complexType>
        </xsd:element>
    </pd:endType>
    <pd:endX>1516</pd:endX>
    <pd:endY>312</pd:endY>
    <pd:errorSchemas/>
    <pd:processVariables>
        <ServiceResponse>
            <xsd:element name="ServiceResponse">
                <xsd:complexType>
                    <xsd:sequence>
                        <xsd:element name="Status" type="xsd:int"/>
                        <xsd:element name="Err_msg" type="xsd:string" minOccurs="0"/>
                        <xsd:element ref="pfx11:ServiceResponse" minOccurs="0"/>
                    </xsd:sequence>
                </xsd:complexType>
            </xsd:element>
        </ServiceResponse>
        <BTCTUpdateSchema ref="pfx5:BTCTUpdate"/>
        <ListNettingResult>
            <xsd:element name="ListNettingResult">
                <xsd:complexType>
                    <xsd:sequence>
                        <xsd:element ref="pfx7:mIBPSREF" minOccurs="0" maxOccurs="unbounded"/>
                    </xsd:sequence>
                </xsd:complexType>
            </xsd:element>
        </ListNettingResult>
        <ReadError>
            <xsd:element name="Input">
                <xsd:complexType>
                    <xsd:sequence>
                        <xsd:element name="ReadError" type="xsd:boolean"/>
                        <xsd:element name="RowsCount" type="xsd:int"/>
                    </xsd:sequence>
                </xsd:complexType>
            </xsd:element>
        </ReadError>
        <DBResponse>
            <xsd:element name="DBResponse" type="xsd:string"/>
        </DBResponse>
    </pd:processVariables>
    <pd:targetNamespace>sbv/services/BTCTPosting/requestresponse/1.0</pd:targetNamespace>
    <pd:group name="Loop Handling Record">
        <pd:type>com.tibco.pe.core.LoopGroup</pd:type>
        <pd:resourceType>ae.process.group</pd:resourceType>
        <pd:description>Convert/Format Each Record</pd:description>
        <pd:x>135</pd:x>
        <pd:y>211</pd:y>
        <pd:width>470</pd:width>
        <pd:height>350</pd:height>
        <pd:collapsedWidth>57</pd:collapsedWidth>
        <pd:collapsedHeight>70</pd:collapsedHeight>
        <pd:groupVariables/>
        <pd:joinToggle>inherit</pd:joinToggle>
        <config>
            <pd:groupType>while</pd:groupType>
            <pd:serializable>false</pd:serializable>
            <pd:indexSlot>index</pd:indexSlot>
            <pd:activityOutputName/>
            <pd:whileCondition>$index &lt;= $ReadError/Input/RowsCount  and $ReadError/Input/ReadError = 'false'</pd:whileCondition>
            <pd:accumulateOutput>false</pd:accumulateOutput>
        </config>
        <pd:inputBindings/>
        <pd:expanded>true</pd:expanded>
        <pd:transition>
            <pd:from>start</pd:from>
            <pd:to>Map ESB Model</pd:to>
            <pd:lineType>Default</pd:lineType>
            <pd:lineColor>-16777216</pd:lineColor>
            <pd:conditionType>always</pd:conditionType>
        </pd:transition>
        <pd:transition>
            <pd:from>Assign Credit</pd:from>
            <pd:to>end</pd:to>
            <pd:lineType>Multiple Bends</pd:lineType>
            <pd:lineColor>-16777216</pd:lineColor>
            <pd:conditionType>always</pd:conditionType>
        </pd:transition>
        <pd:transition>
            <pd:from>SR-Input Data Invalid</pd:from>
            <pd:to>end</pd:to>
            <pd:xpathDescription> </pd:xpathDescription>
            <pd:lineType>One Bend</pd:lineType>
            <pd:lineColor>-16777216</pd:lineColor>
            <pd:conditionType>always</pd:conditionType>
        </pd:transition>
        <pd:transition>
            <pd:from>Assign Debit</pd:from>
            <pd:to>end</pd:to>
            <pd:lineType>Multiple Bends</pd:lineType>
            <pd:lineColor>-16777216</pd:lineColor>
            <pd:conditionType>always</pd:conditionType>
        </pd:transition>
        <pd:transition>
            <pd:from>Do Nothing</pd:from>
            <pd:to>end</pd:to>
            <pd:xpathDescription>Not need to Insert</pd:xpathDescription>
            <pd:lineType>Multiple Bends</pd:lineType>
            <pd:lineColor>-16777216</pd:lineColor>
            <pd:conditionType>always</pd:conditionType>
        </pd:transition>
        <pd:transition>
            <pd:from>Map ESB Model</pd:from>
            <pd:to>ExitLoop</pd:to>
            <pd:xpathDescription>Error</pd:xpathDescription>
            <pd:lineType>Default</pd:lineType>
            <pd:lineColor>-16777216</pd:lineColor>
            <pd:conditionType>error</pd:conditionType>
        </pd:transition>
        <pd:transition>
            <pd:from>Map ESB Model</pd:from>
            <pd:to>Navigate</pd:to>
            <pd:lineType>Default</pd:lineType>
            <pd:lineColor>-16777216</pd:lineColor>
            <pd:conditionType>always</pd:conditionType>
        </pd:transition>
        <pd:transition>
            <pd:from>Navigate</pd:from>
            <pd:to>Assign Debit</pd:to>
            <pd:xpathDescription>DebitLine</pd:xpathDescription>
            <pd:lineType>Multiple Bends</pd:lineType>
            <pd:lineColor>-16777216</pd:lineColor>
            <pd:conditionType>xpath</pd:conditionType>
            <pd:xpath>$Map-ESB-Model/pfx3:BTCT_Posting_Model/pfx3:TTBTDT_DATA/pfx3:SODUOCTHU &gt; 0</pd:xpath>
        </pd:transition>
        <pd:transition>
            <pd:from>Navigate</pd:from>
            <pd:to>Assign Credit</pd:to>
            <pd:xpathDescription>CreditLine</pd:xpathDescription>
            <pd:lineType>Multiple Bends</pd:lineType>
            <pd:lineColor>-16777216</pd:lineColor>
            <pd:conditionType>xpath</pd:conditionType>
            <pd:xpath>$Map-ESB-Model/pfx3:BTCT_Posting_Model/pfx3:TTBTDT_DATA/pfx3:SOPHAITRA &gt; 0</pd:xpath>
        </pd:transition>
        <pd:transition>
            <pd:from>Navigate</pd:from>
            <pd:to>Do Nothing</pd:to>
            <pd:xpathDescription> </pd:xpathDescription>
            <pd:lineType>Multiple Bends</pd:lineType>
            <pd:lineColor>-16777216</pd:lineColor>
            <pd:conditionType>xpath</pd:conditionType>
            <pd:xpath>($Map-ESB-Model/pfx3:BTCT_Posting_Model/pfx3:TTBTDT_DATA/pfx3:SODUOCTHU = 0) and ($Map-ESB-Model/pfx3:BTCT_Posting_Model/pfx3:TTBTDT_DATA/pfx3:SOPHAITRA = 0)</pd:xpath>
        </pd:transition>
        <pd:transition>
            <pd:from>ExitLoop</pd:from>
            <pd:to>SR-Input Data Invalid</pd:to>
            <pd:lineType>Default</pd:lineType>
            <pd:lineColor>-16777216</pd:lineColor>
            <pd:conditionType>always</pd:conditionType>
        </pd:transition>
        <pd:activity name="Map ESB Model">
            <pd:type>com.tibco.plugin.mapper.MapperActivity</pd:type>
            <pd:resourceType>ae.activities.MapperActivity</pd:resourceType>
            <pd:description>// Dữ liệu về T24. Add thêm, current_timestamps với mỗi Record</pd:description>
            <pd:x>221</pd:x>
            <pd:y>266</pd:y>
            <config>
                <element ref="pfx3:BTCT_Posting_Model"/>
            </config>
            <pd:inputBindings>
                <pfx3:BTCT_Posting_Model>
                    <pfx3:Addition_Data>
                        <pfx3:currency_timestamp>
                            <xsl:value-of select="tib:timestamp()"/>
                        </pfx3:currency_timestamp>
                        <xsl:if test="$GetBTCTData/resultSet/Record[$index]/THANHVIEN_REF">
                            <pfx3:UNIQUE_ID>
                                <xsl:value-of select="$GetBTCTData/resultSet/Record[$index]/THANHVIEN_REF"/>
                            </pfx3:UNIQUE_ID>
                        </xsl:if>
                    </pfx3:Addition_Data>
                    <pfx3:TTBTDT_DATA>
                        <xsl:if test="$GetBTCTData/resultSet/Record[$index]/CHUTRI_REF">
                            <pfx3:CHUTRI_REF>
                                <xsl:value-of select="$GetBTCTData/resultSet/Record[$index]/CHUTRI_REF"/>
                            </pfx3:CHUTRI_REF>
                        </xsl:if>
                        <xsl:if test="$GetBTCTData/resultSet/Record[$index]/THANHVIEN_REF">
                            <pfx3:THANHVIEN_REF>
                                <xsl:value-of select="$GetBTCTData/resultSet/Record[$index]/THANHVIEN_REF"/>
                            </pfx3:THANHVIEN_REF>
                        </xsl:if>
                        <xsl:if test="$GetBTCTData/resultSet/Record[$index]/MA_CHINHANH_T24">
                            <pfx3:MA_CHINHANH_T24>
                                <xsl:value-of select="$GetBTCTData/resultSet/Record[$index]/MA_CHINHANH_T24"/>
                            </pfx3:MA_CHINHANH_T24>
                        </xsl:if>
                        <xsl:if test="$GetBTCTData/resultSet/Record[$index]/SENT_TO_T24">
                            <pfx3:SENT_TO_T24>
                                <xsl:value-of select="$GetBTCTData/resultSet/Record[$index]/SENT_TO_T24"/>
                            </pfx3:SENT_TO_T24>
                        </xsl:if>
                        <xsl:if test="$GetBTCTData/resultSet/Record[$index]/ERR_MSG">
                            <pfx3:ERR_MSG>
                                <xsl:value-of select="$GetBTCTData/resultSet/Record[$index]/ERR_MSG"/>
                            </pfx3:ERR_MSG>
                        </xsl:if>
                        <pfx3:SHNH>
                            <xsl:value-of select="$GetBTCTData/resultSet/Record[$index]/SHNH"/>
                        </pfx3:SHNH>
                        <pfx3:NGAY>
                            <xsl:value-of select="$GetBTCTData/resultSet/Record[$index]/NGAY"/>
                        </pfx3:NGAY>
                        <pfx3:PHIEN>
                            <xsl:value-of select="$GetBTCTData/resultSet/Record[$index]/PHIEN"/>
                        </pfx3:PHIEN>
                        <xsl:if test="$GetBTCTData/resultSet/Record[$index]/TINHTRANG">
                            <pfx3:TINHTRANG>
                                <xsl:value-of select="$GetBTCTData/resultSet/Record[$index]/TINHTRANG"/>
                            </pfx3:TINHTRANG>
                        </xsl:if>
                        <xsl:if test="$GetBTCTData/resultSet/Record[$index]/SODUOCTHU">
                            <pfx3:SODUOCTHU>
                                <xsl:value-of select="$GetBTCTData/resultSet/Record[$index]/SODUOCTHU"/>
                            </pfx3:SODUOCTHU>
                        </xsl:if>
                        <xsl:if test="$GetBTCTData/resultSet/Record[$index]/SOPHAITRA">
                            <pfx3:SOPHAITRA>
                                <xsl:value-of select="$GetBTCTData/resultSet/Record[$index]/SOPHAITRA"/>
                            </pfx3:SOPHAITRA>
                        </xsl:if>
                    </pfx3:TTBTDT_DATA>
                </pfx3:BTCT_Posting_Model>
            </pd:inputBindings>
        </pd:activity>
        <pd:activity name="Assign Debit">
            <pd:type>com.tibco.pe.core.AssignActivity</pd:type>
            <pd:resourceType>ae.activities.assignActivity</pd:resourceType>
            <pd:x>408</pd:x>
            <pd:y>341</pd:y>
            <config>
                <variableName>ListNettingResult</variableName>
            </config>
            <pd:inputBindings>
                <ListNettingResult>
                    <xsl:copy-of select="$ListNettingResult/ListNettingResult/pfx7:mIBPSREF"/>
                    <pfx7:mIBPSREF>
                        <IBPSREF>
                            <xsl:value-of select="concat(  $_globalVariables/ns2:GlobalVariables/ServiceGlobalVar/BTCTPosting/T24WS_SYSTEMTYPE, $Map-ESB-Model/pfx3:BTCT_Posting_Model/pfx3:TTBTDT_DATA/pfx3:THANHVIEN_REF)"/>
                        </IBPSREF>
                        <DEBITCURRENCY>
                            <xsl:value-of select="$_globalVariables/ns2:GlobalVariables/ServiceGlobalVar/BTCTPosting/T24WS_Currency"/>
                        </DEBITCURRENCY>
                        <xsl:if test="$Map-ESB-Model/pfx3:BTCT_Posting_Model/pfx3:TTBTDT_DATA/pfx3:SODUOCTHU">
                            <DEBITAMOUNT>
                                <xsl:value-of select="$Map-ESB-Model/pfx3:BTCT_Posting_Model/pfx3:TTBTDT_DATA/pfx3:SODUOCTHU"/>
                            </DEBITAMOUNT>
                        </xsl:if>
                        <DEBITVALUEDATE>
                            <xsl:value-of select="$Map-ESB-Model/pfx3:BTCT_Posting_Model/pfx3:TTBTDT_DATA/pfx3:NGAY"/>
                        </DEBITVALUEDATE>
                        <CREDITCITADNO>
                            <xsl:value-of select="$Map-ESB-Model/pfx3:BTCT_Posting_Model/pfx3:TTBTDT_DATA/pfx3:SHNH"/>
                        </CREDITCITADNO>
                        <CREDITVALUEDATE>
                            <xsl:value-of select="$Map-ESB-Model/pfx3:BTCT_Posting_Model/pfx3:TTBTDT_DATA/pfx3:NGAY"/>
                        </CREDITVALUEDATE>
                    </pfx7:mIBPSREF>
                </ListNettingResult>
            </pd:inputBindings>
        </pd:activity>
        <pd:activity name="Assign Credit">
            <pd:type>com.tibco.pe.core.AssignActivity</pd:type>
            <pd:resourceType>ae.activities.assignActivity</pd:resourceType>
            <pd:x>409</pd:x>
            <pd:y>417</pd:y>
            <config>
                <variableName>ListNettingResult</variableName>
            </config>
            <pd:inputBindings>
                <ListNettingResult>
                    <xsl:copy-of select="$ListNettingResult/ListNettingResult/pfx7:mIBPSREF"/>
                    <pfx7:mIBPSREF>
                        <IBPSREF>
                            <xsl:value-of select="concat(  $_globalVariables/ns2:GlobalVariables/ServiceGlobalVar/BTCTPosting/T24WS_SYSTEMTYPE, $Map-ESB-Model/pfx3:BTCT_Posting_Model/pfx3:TTBTDT_DATA/pfx3:THANHVIEN_REF)"/>
                        </IBPSREF>
                        <DEBITCITADNO>
                            <xsl:value-of select="$Map-ESB-Model/pfx3:BTCT_Posting_Model/pfx3:TTBTDT_DATA/pfx3:SHNH"/>
                        </DEBITCITADNO>
                        <DEBITCURRENCY>
                            <xsl:value-of select="$_globalVariables/ns2:GlobalVariables/ServiceGlobalVar/BTCTPosting/T24WS_Currency"/>
                        </DEBITCURRENCY>
                        <xsl:if test="$Map-ESB-Model/pfx3:BTCT_Posting_Model/pfx3:TTBTDT_DATA/pfx3:SOPHAITRA">
                            <DEBITAMOUNT>
                                <xsl:value-of select="$Map-ESB-Model/pfx3:BTCT_Posting_Model/pfx3:TTBTDT_DATA/pfx3:SOPHAITRA"/>
                            </DEBITAMOUNT>
                        </xsl:if>
                        <DEBITVALUEDATE>
                            <xsl:value-of select="$Map-ESB-Model/pfx3:BTCT_Posting_Model/pfx3:TTBTDT_DATA/pfx3:NGAY"/>
                        </DEBITVALUEDATE>
                        <CREDITCURRENCY>
                            <xsl:value-of select="$_globalVariables/ns2:GlobalVariables/ServiceGlobalVar/BTCTPosting/T24WS_Currency"/>
                        </CREDITCURRENCY>
                        <CREDITVALUEDATE>
                            <xsl:value-of select="$Map-ESB-Model/pfx3:BTCT_Posting_Model/pfx3:TTBTDT_DATA/pfx3:NGAY"/>
                        </CREDITVALUEDATE>
                    </pfx7:mIBPSREF>
                </ListNettingResult>
            </pd:inputBindings>
        </pd:activity>
        <pd:activity name="Navigate">
            <pd:type>com.tibco.plugin.timer.NullActivity</pd:type>
            <pd:resourceType>ae.activities.null</pd:resourceType>
            <pd:x>221</pd:x>
            <pd:y>417</pd:y>
            <config/>
            <pd:inputBindings/>
        </pd:activity>
        <pd:activity name="Do Nothing">
            <pd:type>com.tibco.plugin.timer.NullActivity</pd:type>
            <pd:resourceType>ae.activities.null</pd:resourceType>
            <pd:x>408</pd:x>
            <pd:y>505</pd:y>
            <config/>
            <pd:inputBindings/>
        </pd:activity>
        <pd:activity name="ExitLoop">
            <pd:type>com.tibco.pe.core.AssignActivity</pd:type>
            <pd:resourceType>ae.activities.assignActivity</pd:resourceType>
            <pd:x>357</pd:x>
            <pd:y>267</pd:y>
            <config>
                <variableName>ReadError</variableName>
            </config>
            <pd:inputBindings>
                <Input>
                    <ReadError>
                        <xsl:value-of select="'true'"/>
                    </ReadError>
                    <RowsCount>
                        <xsl:value-of select="count($GetBTCTData/resultSet/Record)"/>
                    </RowsCount>
                </Input>
            </pd:inputBindings>
        </pd:activity>
        <pd:activity name="SR-Input Data Invalid">
            <pd:type>com.tibco.pe.core.AssignActivity</pd:type>
            <pd:resourceType>ae.activities.assignActivity</pd:resourceType>
            <pd:x>464</pd:x>
            <pd:y>276</pd:y>
            <config>
                <variableName>ServiceResponse</variableName>
            </config>
            <pd:inputBindings>
                <ServiceResponse>
                    <Status>
                        <xsl:value-of select="1"/>
                    </Status>
                    <Err_msg>
                        <xsl:value-of select="concat(&quot;Data Input Invalid : &quot; , $_error/ns3:ErrorReport/Msg)"/>
                    </Err_msg>
                    <pfx11:ServiceResponse>
                        <pfx11:Status>
                            <xsl:value-of select="1"/>
                        </pfx11:Status>
                        <pfx11:ErrorMessage>
                            <xsl:value-of select="concat(&quot;Data Input Invalid : &quot; , $_error/ns3:ErrorReport/Msg)"/>
                        </pfx11:ErrorMessage>
                        <pfx11:NotifyMsg>
                            <xsl:value-of select="concat(&quot;Data Input Invalid : &quot; , $_error/ns3:ErrorReport/Msg)"/>
                        </pfx11:NotifyMsg>
                        <pfx11:ErrorExist>
                            <xsl:value-of select="&quot;true&quot;"/>
                        </pfx11:ErrorExist>
                        <xsl:if test="$GetBTCTData/resultSet/Record[$index]/THANHVIEN_REF">
                            <pfx11:Unique_ID>
                                <xsl:value-of select="$GetBTCTData/resultSet/Record[$index]/THANHVIEN_REF"/>
                            </pfx11:Unique_ID>
                        </xsl:if>
                        <xsl:if test="$ServiceResponse/ServiceResponse/pfx11:ServiceResponse/pfx11:timestamps">
                            <pfx11:timestamps>
                                <xsl:value-of select="$ServiceResponse/ServiceResponse/pfx11:ServiceResponse/pfx11:timestamps"/>
                            </pfx11:timestamps>
                        </xsl:if>
                    </pfx11:ServiceResponse>
                </ServiceResponse>
            </pd:inputBindings>
        </pd:activity>
    </pd:group>
    <pd:activity name="GetBTCTData">
        <pd:type>com.tibco.plugin.jdbc.JDBCQueryActivity</pd:type>
        <pd:resourceType>ae.activities.JDBCQueryActivity</pd:resourceType>
        <pd:x>359</pd:x>
        <pd:y>50</pd:y>
        <config>
            <timeout>%%ServiceGlobalVar/BTCTPosting/BTCTDBTimeOut_sec%%</timeout>
            <commit>false</commit>
            <maxRows>%%ServiceGlobalVar/BTCTPosting/BTCTDBMaxRows%%</maxRows>
            <emptyStrAsNil>false</emptyStrAsNil>
            <wizardData/>
            <statement>Select * from CHU_TRI where 1 = 1
and CHUTRI_REF = ?
and SENT_TO_T24 = ?</statement>
            <Prepared_Param_DataType>
                <parameter>
                    <parameterName>CHUTRI_REF</parameterName>
                    <dataType>VARCHAR</dataType>
                </parameter>
                <parameter>
                    <parameterName>STATUS</parameterName>
                    <dataType>VARCHAR</dataType>
                </parameter>
            </Prepared_Param_DataType>
            <oraObjects/>
            <oraTables/>
            <QueryOutputCachedSchemaColumns>CHUTRI_REF</QueryOutputCachedSchemaColumns>
            <QueryOutputCachedSchemaDataTypes>12</QueryOutputCachedSchemaDataTypes>
            <QueryOutputCachedSchemaDataTypesName>VARCHAR2</QueryOutputCachedSchemaDataTypesName>
            <QueryOutputCachedSchemaStatus>OptionalElement</QueryOutputCachedSchemaStatus>
            <QueryOutputCachedSchemaColumns>THANHVIEN_REF</QueryOutputCachedSchemaColumns>
            <QueryOutputCachedSchemaDataTypes>12</QueryOutputCachedSchemaDataTypes>
            <QueryOutputCachedSchemaDataTypesName>VARCHAR2</QueryOutputCachedSchemaDataTypesName>
            <QueryOutputCachedSchemaStatus>OptionalElement</QueryOutputCachedSchemaStatus>
            <QueryOutputCachedSchemaColumns>MA_CHINHANH_T24</QueryOutputCachedSchemaColumns>
            <QueryOutputCachedSchemaDataTypes>12</QueryOutputCachedSchemaDataTypes>
            <QueryOutputCachedSchemaDataTypesName>VARCHAR2</QueryOutputCachedSchemaDataTypesName>
            <QueryOutputCachedSchemaStatus>OptionalElement</QueryOutputCachedSchemaStatus>
            <QueryOutputCachedSchemaColumns>SENT_TO_T24</QueryOutputCachedSchemaColumns>
            <QueryOutputCachedSchemaDataTypes>-5</QueryOutputCachedSchemaDataTypes>
            <QueryOutputCachedSchemaDataTypesName>NUMBER</QueryOutputCachedSchemaDataTypesName>
            <QueryOutputCachedSchemaStatus>OptionalElement</QueryOutputCachedSchemaStatus>
            <QueryOutputCachedSchemaColumns>ERR_MSG</QueryOutputCachedSchemaColumns>
            <QueryOutputCachedSchemaDataTypes>12</QueryOutputCachedSchemaDataTypes>
            <QueryOutputCachedSchemaDataTypesName>VARCHAR2</QueryOutputCachedSchemaDataTypesName>
            <QueryOutputCachedSchemaStatus>OptionalElement</QueryOutputCachedSchemaStatus>
            <QueryOutputCachedSchemaColumns>SHNH</QueryOutputCachedSchemaColumns>
            <QueryOutputCachedSchemaDataTypes>12</QueryOutputCachedSchemaDataTypes>
            <QueryOutputCachedSchemaDataTypesName>VARCHAR2</QueryOutputCachedSchemaDataTypesName>
            <QueryOutputCachedSchemaStatus>RequiredElement</QueryOutputCachedSchemaStatus>
            <QueryOutputCachedSchemaColumns>NGAY</QueryOutputCachedSchemaColumns>
            <QueryOutputCachedSchemaDataTypes>12</QueryOutputCachedSchemaDataTypes>
            <QueryOutputCachedSchemaDataTypesName>VARCHAR2</QueryOutputCachedSchemaDataTypesName>
            <QueryOutputCachedSchemaStatus>RequiredElement</QueryOutputCachedSchemaStatus>
            <QueryOutputCachedSchemaColumns>PHIEN</QueryOutputCachedSchemaColumns>
            <QueryOutputCachedSchemaDataTypes>-5</QueryOutputCachedSchemaDataTypes>
            <QueryOutputCachedSchemaDataTypesName>NUMBER</QueryOutputCachedSchemaDataTypesName>
            <QueryOutputCachedSchemaStatus>RequiredElement</QueryOutputCachedSchemaStatus>
            <QueryOutputCachedSchemaColumns>TINHTRANG</QueryOutputCachedSchemaColumns>
            <QueryOutputCachedSchemaDataTypes>12</QueryOutputCachedSchemaDataTypes>
            <QueryOutputCachedSchemaDataTypesName>VARCHAR2</QueryOutputCachedSchemaDataTypesName>
            <QueryOutputCachedSchemaStatus>OptionalElement</QueryOutputCachedSchemaStatus>
            <QueryOutputCachedSchemaColumns>SODUOCTHU</QueryOutputCachedSchemaColumns>
            <QueryOutputCachedSchemaDataTypes>2</QueryOutputCachedSchemaDataTypes>
            <QueryOutputCachedSchemaDataTypesName>NUMBER</QueryOutputCachedSchemaDataTypesName>
            <QueryOutputCachedSchemaStatus>OptionalElement</QueryOutputCachedSchemaStatus>
            <QueryOutputCachedSchemaColumns>SOPHAITRA</QueryOutputCachedSchemaColumns>
            <QueryOutputCachedSchemaDataTypes>2</QueryOutputCachedSchemaDataTypes>
            <QueryOutputCachedSchemaDataTypesName>NUMBER</QueryOutputCachedSchemaDataTypesName>
            <QueryOutputCachedSchemaStatus>OptionalElement</QueryOutputCachedSchemaStatus>
            <jdbcSharedConfig>/SharedResource/Connection/Jdbc/BTCTDB.sharedjdbc</jdbcSharedConfig>
        </config>
        <pd:coercions>
            <pd:coercion xpath="$Start/root/pfx2:ServiceEnverlop/ServiceBody/*" element="ns1:RequestBody" cardinality=""/>
        </pd:coercions>
        <pd:inputBindings>
            <jdbcQueryActivityInput>
                <CHUTRI_REF>
                    <xsl:choose>
                        <xsl:when test="exists($Start/root/pfx2:ServiceEnverlop/ServiceBody/ns1:RequestBody/ns1:CHUTRI_REF[1])">
                            <xsl:value-of select="$Start/root/pfx2:ServiceEnverlop/ServiceBody/ns1:RequestBody/ns1:CHUTRI_REF[1]"/>
                        </xsl:when>
                        <xsl:otherwise>
                            <xsl:attribute name="xsi:nil">true</xsl:attribute>
                        </xsl:otherwise>
                    </xsl:choose>
                </CHUTRI_REF>
                <STATUS>
                    <xsl:value-of select="$_globalVariables/ns2:GlobalVariables/ServiceGlobalVar/BTCTPosting/RecordDB_T24New"/>
                </STATUS>
            </jdbcQueryActivityInput>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="Catch">
        <pd:type>com.tibco.pe.core.CatchActivity</pd:type>
        <pd:resourceType>ae.activities.catch</pd:resourceType>
        <pd:x>1959</pd:x>
        <pd:y>307</pd:y>
        <pd:handler>true</pd:handler>
        <config>
            <catchAll>true</catchAll>
        </config>
        <pd:inputBindings/>
    </pd:activity>
    <pd:activity name="Sleep">
        <pd:type>com.tibco.plugin.timer.SleepActivity</pd:type>
        <pd:resourceType>ae.activities.sleep</pd:resourceType>
        <pd:x>1813</pd:x>
        <pd:y>309</pd:y>
        <config/>
        <pd:inputBindings>
            <ns14:SleepInputSchema>
                <IntervalInMillisec>
                    <xsl:value-of select="$_globalVariables/ns2:GlobalVariables/ServiceGlobalVar/BTCTPosting/Sleeptime_Exception_ms"/>
                </IntervalInMillisec>
            </ns14:SleepInputSchema>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="errorProcessor-Unexpected">
        <pd:type>com.tibco.pe.core.CallProcessActivity</pd:type>
        <pd:resourceType>ae.process.subprocess</pd:resourceType>
        <pd:x>1664</pd:x>
        <pd:y>310</pd:y>
        <config>
            <processName>/Util/ExceptionHandling/errorProcessor.process</processName>
        </config>
        <pd:inputBindings>
            <root>
                <ProcessName>
                    <xsl:value-of select="BW:getCurrentProcessName($_processContext/ns3:ProcessContext/ProcessId)"/>
                </ProcessName>
                <GeneratedId>
                    <xsl:value-of select="$GetBTCTData/resultSet/Record[$index]/THANHVIEN_REF"/>
                </GeneratedId>
                <ns13:ExceptionBody>
                    <ns13:Hostname>
                        <xsl:value-of select="BW:getHostName()"/>
                    </ns13:Hostname>
                    <ns13:Category>
                        <xsl:value-of select="&quot;ERROR&quot;"/>
                    </ns13:Category>
                    <ns13:Type>
                        <xsl:value-of select="&quot;MAP ERROR&quot;"/>
                    </ns13:Type>
                    <ns13:Level>
                        <xsl:value-of select="&quot;level&quot;"/>
                    </ns13:Level>
                    <xsl:for-each xmlns:xsl="http://www.w3.org/1999/XSL/Transform" select="$_error/ns3:ErrorReport">
                        <ns13:ErrorReport>
                            <StackTrace>
                                <xsl:value-of select="StackTrace"/>
                            </StackTrace>
                            <Msg>
                                <xsl:value-of select="Msg"/>
                            </Msg>
                            <FullClass>
                                <xsl:value-of select="FullClass"/>
                            </FullClass>
                            <ObjectClass>
                                <xsl:value-of select="Class"/>
                            </ObjectClass>
                            <ProcessStack>
                                <xsl:value-of select="ProcessStack"/>
                            </ProcessStack>
                            <xsl:if test="MsgCode">
                                <MsgCode>
                                    <xsl:value-of select="MsgCode"/>
                                </MsgCode>
                            </xsl:if>
                            <xsl:copy-of select="Data"/>
                        </ns13:ErrorReport>
                    </xsl:for-each>
                </ns13:ExceptionBody>
                <ServiceInput>
                    <ns:AppHdr>
                        <ns:CharSet>
                            <xsl:value-of select="&quot;UTF-8&quot;"/>
                        </ns:CharSet>
                        <ns:ServVersion>
                            <xsl:value-of select="&quot;1.0&quot;"/>
                        </ns:ServVersion>
                        <ns:From>
                            <ns:Id>
                                <xsl:value-of select="&quot;08&quot;"/>
                            </ns:Id>
                            <ns:Name>
                                <xsl:value-of select="&quot;TTBTDT&quot;"/>
                            </ns:Name>
                        </ns:From>
                        <ns:To>
                            <ns:Id>
                                <xsl:value-of select="&quot;24&quot;"/>
                            </ns:Id>
                            <ns:Name>
                                <xsl:value-of select="&quot;T24&quot;"/>
                            </ns:Name>
                        </ns:To>
                        <ns:MsgId>
                            <xsl:value-of select="$GetBTCTData/resultSet/Record[$index]/CHUTRI_REF"/>
                        </ns:MsgId>
                        <ns:BizServ>
                            <ns:Id>
                                <xsl:value-of select="&quot;6&quot;"/>
                            </ns:Id>
                            <ns:Name>
                                <xsl:value-of select="&quot;T24TTBTDT&quot;"/>
                            </ns:Name>
                        </ns:BizServ>
                        <ns:CreatedDate>
                            <xsl:value-of select="current-dateTime()"/>
                        </ns:CreatedDate>
                    </ns:AppHdr>
                    <ServiceBody/>
                </ServiceInput>
            </root>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="Map-to-T24-Request">
        <pd:type>com.tibco.plugin.mapper.MapperActivity</pd:type>
        <pd:resourceType>ae.activities.MapperActivity</pd:resourceType>
        <pd:x>700</pd:x>
        <pd:y>396</pd:y>
        <config>
            <element ref="pfx4:SettleTTBT"/>
        </config>
        <pd:inputBindings>
            <pfx4:SettleTTBT>
                <WebRequestCommon>
                    <xsl:if test="$Map-ESB-Model/pfx3:BTCT_Posting_Model/pfx3:TTBTDT_DATA/pfx3:MA_CHINHANH_T24">
                        <company>
                            <xsl:value-of select="$Map-ESB-Model/pfx3:BTCT_Posting_Model/pfx3:TTBTDT_DATA/pfx3:MA_CHINHANH_T24"/>
                        </company>
                    </xsl:if>
                    <password>
                        <xsl:value-of select="$_globalVariables/ns2:GlobalVariables/ServiceGlobalVar/BTCTPosting/T24WS_Pass"/>
                    </password>
                    <userName>
                        <xsl:value-of select="$_globalVariables/ns2:GlobalVariables/ServiceGlobalVar/BTCTPosting/T24WS_User"/>
                    </userName>
                </WebRequestCommon>
                <OfsFunction>
                    <activityName>
                        <xsl:value-of select="&quot;&quot;"/>
                    </activityName>
                    <assignReason>
                        <xsl:value-of select="&quot;&quot;"/>
                    </assignReason>
                    <dueDate>
                        <xsl:value-of select="&quot;&quot;"/>
                    </dueDate>
                    <extProcess>
                        <xsl:value-of select="&quot;&quot;"/>
                    </extProcess>
                    <extProcessID>
                        <xsl:value-of select="&quot;&quot;"/>
                    </extProcessID>
                    <gtsControl>
                        <xsl:value-of select="&quot;&quot;"/>
                    </gtsControl>
                    <messageId>
                        <xsl:value-of select="&quot;&quot;"/>
                    </messageId>
                    <noOfAuth>
                        <xsl:value-of select="&quot;&quot;"/>
                    </noOfAuth>
                    <owner>
                        <xsl:value-of select="&quot;&quot;"/>
                    </owner>
                    <replace>
                        <xsl:value-of select="&quot;&quot;"/>
                    </replace>
                    <startDate>
                        <xsl:value-of select="&quot;&quot;"/>
                    </startDate>
                    <user>
                        <xsl:value-of select="&quot;&quot;"/>
                    </user>
                </OfsFunction>
                <SBVFTLVBULKSBVBTDTCTWSType>
                    <xsl:attribute name="id">
                        <xsl:value-of select="concat( $_globalVariables/ns2:GlobalVariables/ServiceGlobalVar/BTCTPosting/T24WS_SYSTEMTYPE, $Map-ESB-Model/pfx3:BTCT_Posting_Model/pfx3:TTBTDT_DATA/pfx3:CHUTRI_REF)"/>
                    </xsl:attribute>
                    <gIBPSREF>
                        <xsl:for-each select="$ListNettingResult/ListNettingResult/pfx7:mIBPSREF">
                            <mIBPSREF>
                                <xsl:if test="@m">
                                    <xsl:attribute name="m">
                                        <xsl:value-of select="@m"/>
                                    </xsl:attribute>
                                </xsl:if>
                                <xsl:if test="IBPSREF">
                                    <IBPSREF>
                                        <xsl:value-of select="IBPSREF"/>
                                    </IBPSREF>
                                </xsl:if>
                                <xsl:if test="DEBITCITADNO">
                                    <DEBITCITADNO>
                                        <xsl:value-of select="DEBITCITADNO"/>
                                    </DEBITCITADNO>
                                </xsl:if>
                                <xsl:if test="DEBITCURRENCY">
                                    <DEBITCURRENCY>
                                        <xsl:value-of select="DEBITCURRENCY"/>
                                    </DEBITCURRENCY>
                                </xsl:if>
                                <xsl:if test="DEBITAMOUNT">
                                    <DEBITAMOUNT>
                                        <xsl:value-of select="DEBITAMOUNT"/>
                                    </DEBITAMOUNT>
                                </xsl:if>
                                <xsl:if test="DEBITVALUEDATE">
                                    <DEBITVALUEDATE>
                                        <xsl:value-of select="DEBITVALUEDATE"/>
                                    </DEBITVALUEDATE>
                                </xsl:if>
                                <xsl:if test="CREDITCITADNO">
                                    <CREDITCITADNO>
                                        <xsl:value-of select="CREDITCITADNO"/>
                                    </CREDITCITADNO>
                                </xsl:if>
                                <xsl:if test="CREDITCURRENCY">
                                    <CREDITCURRENCY>
                                        <xsl:value-of select="CREDITCURRENCY"/>
                                    </CREDITCURRENCY>
                                </xsl:if>
                                <xsl:if test="CREDITAMOUNT">
                                    <CREDITAMOUNT>
                                        <xsl:value-of select="CREDITAMOUNT"/>
                                    </CREDITAMOUNT>
                                </xsl:if>
                                <xsl:if test="CREDITVALUEDATE">
                                    <CREDITVALUEDATE>
                                        <xsl:value-of select="CREDITVALUEDATE"/>
                                    </CREDITVALUEDATE>
                                </xsl:if>
                                <xsl:if test="TRANSCOUNT">
                                    <TRANSCOUNT>
                                        <xsl:value-of select="TRANSCOUNT"/>
                                    </TRANSCOUNT>
                                </xsl:if>
                            </mIBPSREF>
                        </xsl:for-each>
                    </gIBPSREF>
                    <SYSTEMTYPE>
                        <xsl:value-of select="$_globalVariables/ns2:GlobalVariables/ServiceGlobalVar/BTCTPosting/T24WS_SYSTEMTYPE"/>
                    </SYSTEMTYPE>
                    <TRANSFLAG>
                        <xsl:value-of select="substring($Start/root/pfx2:ServiceEnverlop/ServiceBody/ns1:RequestBody/ns1:CHUTRI_REF[1], string-length($Start/root/pfx2:ServiceEnverlop/ServiceBody/ns1:RequestBody/ns1:CHUTRI_REF[1]),1 )"/>
                    </TRANSFLAG>
                    <xsl:if test="$Map-ESB-Model/pfx3:BTCT_Posting_Model/pfx3:TTBTDT_DATA/pfx3:MA_CHINHANH_T24">
                        <COMPANYCODE>
                            <xsl:value-of select="$Map-ESB-Model/pfx3:BTCT_Posting_Model/pfx3:TTBTDT_DATA/pfx3:MA_CHINHANH_T24"/>
                        </COMPANYCODE>
                    </xsl:if>
                </SBVFTLVBULKSBVBTDTCTWSType>
            </pfx4:SettleTTBT>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="PostToT24_SettleTTBT">
        <pd:type>com.tibco.plugin.soap.SOAPSendReceiveActivity</pd:type>
        <pd:resourceType>ae.activities.SOAPSendReceiveUI</pd:resourceType>
        <pd:x>828</pd:x>
        <pd:y>397</pd:y>
        <config>
            <timeout>%%ServiceGlobalVar/BTCTPosting/T24WS_timeout_sec%%</timeout>
            <soapAttachmentStyle>SwA</soapAttachmentStyle>
            <timeoutType>Seconds</timeoutType>
            <service>pfx4:T24WebServicesImplService</service>
            <servicePort>T24WebServicesImplPort</servicePort>
            <operation>SettleTTBT</operation>
            <soapAction/>
            <endpointURL>%%T24WS/T24BTCTPosting%%</endpointURL>
            <authScheme>NONE</authScheme>
        </config>
        <pd:inputBindings>
            <inputMessage>
                <xsl:copy-of select="$Map-to-T24-Request/pfx4:SettleTTBT"/>
            </inputMessage>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="UpdateSuccess">
        <pd:type>com.tibco.plugin.jdbc.JDBCUpdateActivity</pd:type>
        <pd:resourceType>ae.activities.JDBCUpdateActivity</pd:resourceType>
        <pd:x>1135</pd:x>
        <pd:y>528</pd:y>
        <config>
            <timeout>%%ServiceGlobalVar/BTCTPosting/JDBC_TimeOut_sec%%</timeout>
            <commit>false</commit>
            <emptyStrAsNil>false</emptyStrAsNil>
            <statement>update CHU_TRI 
set SENT_TO_T24 = ?
, ERR_MSG = ?
where 1 = 1
and CHUTRI_REF = ?
and SENT_TO_T24 = ?</statement>
            <Prepared_Param_DataType>
                <parameter>
                    <parameterName>SENT_TO_T24</parameterName>
                    <dataType>VARCHAR</dataType>
                </parameter>
                <parameter>
                    <parameterName>ERR_MSG</parameterName>
                    <dataType>VARCHAR</dataType>
                </parameter>
                <parameter>
                    <parameterName>CHUTRI_REF</parameterName>
                    <dataType>VARCHAR</dataType>
                </parameter>
                <parameter>
                    <parameterName>SENT_TO_T24_NEW</parameterName>
                    <dataType>VARCHAR</dataType>
                </parameter>
            </Prepared_Param_DataType>
            <jdbcSharedConfig>/SharedResource/Connection/Jdbc/BTCTDB.sharedjdbc</jdbcSharedConfig>
        </config>
        <pd:inputBindings>
            <jdbcUpdateActivityInput>
                <SENT_TO_T24>
                    <xsl:value-of select="$_globalVariables/ns2:GlobalVariables/ServiceGlobalVar/BTCTPosting/RecordDB_T24Success"/>
                </SENT_TO_T24>
                <ERR_MSG>
                    <xsl:value-of select="concat($BTCTUpdateSchema/pfx5:BTCTUpdate/pfx5:transactionId , '---' , $BTCTUpdateSchema/pfx5:BTCTUpdate/pfx5:messages , '---' ,   $BTCTUpdateSchema/pfx5:BTCTUpdate/pfx5:FTGENERATELSTAT)"/>
                </ERR_MSG>
                <CHUTRI_REF>
                    <xsl:choose>
                        <xsl:when test="exists($BTCTUpdateSchema/pfx5:BTCTUpdate/pfx5:CHUTRI_REF)">
                            <xsl:value-of select="$BTCTUpdateSchema/pfx5:BTCTUpdate/pfx5:CHUTRI_REF"/>
                        </xsl:when>
                        <xsl:otherwise>
                            <xsl:attribute name="xsi:nil">true</xsl:attribute>
                        </xsl:otherwise>
                    </xsl:choose>
                </CHUTRI_REF>
                <SENT_TO_T24_NEW>
                    <xsl:value-of select="$_globalVariables/ns2:GlobalVariables/ServiceGlobalVar/BTCTPosting/RecordDB_T24New"/>
                </SENT_TO_T24_NEW>
            </jdbcUpdateActivityInput>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="UpdateLogicError">
        <pd:type>com.tibco.plugin.jdbc.JDBCUpdateActivity</pd:type>
        <pd:resourceType>ae.activities.JDBCUpdateActivity</pd:resourceType>
        <pd:x>1137</pd:x>
        <pd:y>361</pd:y>
        <config>
            <timeout>%%ServiceGlobalVar/BTCTPosting/JDBC_TimeOut_sec%%</timeout>
            <commit>false</commit>
            <emptyStrAsNil>false</emptyStrAsNil>
            <statement>update CHU_TRI 
set SENT_TO_T24 = ?
, ERR_MSG = ?
where 1 = 1
and CHUTRI_REF = ?
and SENT_TO_T24 = ?</statement>
            <Prepared_Param_DataType>
                <parameter>
                    <parameterName>SENT_TO_T24</parameterName>
                    <dataType>VARCHAR</dataType>
                </parameter>
                <parameter>
                    <parameterName>ERR_MSG</parameterName>
                    <dataType>VARCHAR</dataType>
                </parameter>
                <parameter>
                    <parameterName>CHUTRI_REF</parameterName>
                    <dataType>VARCHAR</dataType>
                </parameter>
                <parameter>
                    <parameterName>SENT_TO_T24_NEW</parameterName>
                    <dataType>VARCHAR</dataType>
                </parameter>
            </Prepared_Param_DataType>
            <jdbcSharedConfig>/SharedResource/Connection/Jdbc/BTCTDB.sharedjdbc</jdbcSharedConfig>
        </config>
        <pd:inputBindings>
            <jdbcUpdateActivityInput>
                <SENT_TO_T24>
                    <xsl:value-of select="$_globalVariables/ns2:GlobalVariables/ServiceGlobalVar/BTCTPosting/RecordDB_T24Failed"/>
                </SENT_TO_T24>
                <ERR_MSG>
                    <xsl:value-of select="concat($BTCTUpdateSchema/pfx5:BTCTUpdate/pfx5:transactionId , '---' , $BTCTUpdateSchema/pfx5:BTCTUpdate/pfx5:messages , '---' ,   $BTCTUpdateSchema/pfx5:BTCTUpdate/pfx5:FTGENERATELSTAT)"/>
                </ERR_MSG>
                <CHUTRI_REF>
                    <xsl:choose>
                        <xsl:when test="exists($BTCTUpdateSchema/pfx5:BTCTUpdate/pfx5:CHUTRI_REF)">
                            <xsl:value-of select="$BTCTUpdateSchema/pfx5:BTCTUpdate/pfx5:CHUTRI_REF"/>
                        </xsl:when>
                        <xsl:otherwise>
                            <xsl:attribute name="xsi:nil">true</xsl:attribute>
                        </xsl:otherwise>
                    </xsl:choose>
                </CHUTRI_REF>
                <SENT_TO_T24_NEW>
                    <xsl:value-of select="$_globalVariables/ns2:GlobalVariables/ServiceGlobalVar/BTCTPosting/RecordDB_T24New"/>
                </SENT_TO_T24_NEW>
            </jdbcUpdateActivityInput>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="SR-UpdateDB Success">
        <pd:type>com.tibco.pe.core.AssignActivity</pd:type>
        <pd:resourceType>ae.activities.assignActivity</pd:resourceType>
        <pd:x>1364</pd:x>
        <pd:y>321</pd:y>
        <config>
            <variableName>ServiceResponse</variableName>
        </config>
        <pd:inputBindings>
            <ServiceResponse>
                <Status>
                    <xsl:value-of select="if (($BTCTUpdateSchema/pfx5:BTCTUpdate/pfx5:successIndicator=&quot;Success&quot;) and ($BTCTUpdateSchema/pfx5:BTCTUpdate/pfx5:FTGENERATELSTAT='PROCESSED')&#xA;or ($BTCTUpdateSchema/pfx5:BTCTUpdate/pfx5:successIndicator = &quot;T24Error&quot; ) and contains($BTCTUpdateSchema/pfx5:BTCTUpdate/pfx5:messages[1] , &quot;ALREADY ASSIGNED&quot;  )) &#xA;then 0&#xA;else 1"/>
                </Status>
                <Err_msg>
                    <xsl:value-of select="$BTCTUpdateSchema/pfx5:BTCTUpdate/pfx5:messages"/>
                </Err_msg>
                <pfx11:ServiceResponse>
                    <pfx11:Status>
                        <xsl:value-of select="7"/>
                    </pfx11:Status>
                    <pfx11:ErrorMessage>
                        <xsl:value-of select="concat( &quot;Updated DB . Msg : &quot; , $BTCTUpdateSchema/pfx5:BTCTUpdate/pfx5:messages)"/>
                    </pfx11:ErrorMessage>
                    <pfx11:ErrorExist>
                        <xsl:value-of select="&quot;false&quot;"/>
                    </pfx11:ErrorExist>
                    <xsl:if test="$BTCTUpdateSchema/pfx5:BTCTUpdate/pfx5:CHUTRI_REF">
                        <pfx11:Unique_ID>
                            <xsl:value-of select="$BTCTUpdateSchema/pfx5:BTCTUpdate/pfx5:CHUTRI_REF"/>
                        </pfx11:Unique_ID>
                    </xsl:if>
                    <xsl:if test="$ServiceResponse/ServiceResponse/pfx11:ServiceResponse/pfx11:timestamps">
                        <pfx11:timestamps>
                            <xsl:value-of select="$ServiceResponse/ServiceResponse/pfx11:ServiceResponse/pfx11:timestamps"/>
                        </pfx11:timestamps>
                    </xsl:if>
                </pfx11:ServiceResponse>
            </ServiceResponse>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="UpdateExistStatus">
        <pd:type>com.tibco.plugin.jdbc.JDBCUpdateActivity</pd:type>
        <pd:resourceType>ae.activities.JDBCUpdateActivity</pd:resourceType>
        <pd:x>1135</pd:x>
        <pd:y>434</pd:y>
        <config>
            <timeout>%%ServiceGlobalVar/BTCTPosting/JDBC_TimeOut_sec%%</timeout>
            <commit>false</commit>
            <emptyStrAsNil>false</emptyStrAsNil>
            <statement>update CHU_TRI 
set SENT_TO_T24 = ?
, ERR_MSG = ?
where 1 = 1
and CHUTRI_REF = ?
and SENT_TO_T24 = ?</statement>
            <Prepared_Param_DataType>
                <parameter>
                    <parameterName>SENT_TO_T24</parameterName>
                    <dataType>VARCHAR</dataType>
                </parameter>
                <parameter>
                    <parameterName>ERR_MSG</parameterName>
                    <dataType>VARCHAR</dataType>
                </parameter>
                <parameter>
                    <parameterName>CHUTRI_REF</parameterName>
                    <dataType>VARCHAR</dataType>
                </parameter>
                <parameter>
                    <parameterName>SENT_TO_T24_NEW</parameterName>
                    <dataType>VARCHAR</dataType>
                </parameter>
            </Prepared_Param_DataType>
            <jdbcSharedConfig>/SharedResource/Connection/Jdbc/BTCTDB.sharedjdbc</jdbcSharedConfig>
        </config>
        <pd:inputBindings>
            <jdbcUpdateActivityInput>
                <SENT_TO_T24>
                    <xsl:value-of select="$_globalVariables/ns2:GlobalVariables/ServiceGlobalVar/BTCTPosting/RecordDB_T24Success"/>
                </SENT_TO_T24>
                <ERR_MSG>
                    <xsl:value-of select="$BTCTUpdateSchema/pfx5:BTCTUpdate/pfx5:transactionId"/>
                </ERR_MSG>
                <CHUTRI_REF>
                    <xsl:choose>
                        <xsl:when test="exists($BTCTUpdateSchema/pfx5:BTCTUpdate/pfx5:CHUTRI_REF)">
                            <xsl:value-of select="$BTCTUpdateSchema/pfx5:BTCTUpdate/pfx5:CHUTRI_REF"/>
                        </xsl:when>
                        <xsl:otherwise>
                            <xsl:attribute name="xsi:nil">true</xsl:attribute>
                        </xsl:otherwise>
                    </xsl:choose>
                </CHUTRI_REF>
                <SENT_TO_T24_NEW>
                    <xsl:value-of select="$_globalVariables/ns2:GlobalVariables/ServiceGlobalVar/BTCTPosting/RecordDB_T24New"/>
                </SENT_TO_T24_NEW>
            </jdbcUpdateActivityInput>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="UpdateErrorOnly">
        <pd:type>com.tibco.plugin.jdbc.JDBCUpdateActivity</pd:type>
        <pd:resourceType>ae.activities.JDBCUpdateActivity</pd:resourceType>
        <pd:x>1135</pd:x>
        <pd:y>278</pd:y>
        <config>
            <timeout>%%ServiceGlobalVar/BTCTPosting/JDBC_TimeOut_sec%%</timeout>
            <commit>false</commit>
            <emptyStrAsNil>false</emptyStrAsNil>
            <statement>update CHU_TRI 
set SENT_TO_T24 = ?
, ERR_MSG = ?
where 1 = 1
and CHUTRI_REF = ?
and SENT_TO_T24 = ?</statement>
            <Prepared_Param_DataType>
                <parameter>
                    <parameterName>SENT_TO_T24</parameterName>
                    <dataType>VARCHAR</dataType>
                </parameter>
                <parameter>
                    <parameterName>ERR_MSG</parameterName>
                    <dataType>VARCHAR</dataType>
                </parameter>
                <parameter>
                    <parameterName>CHUTRI_REF</parameterName>
                    <dataType>VARCHAR</dataType>
                </parameter>
                <parameter>
                    <parameterName>SENT_TO_T24_NEW</parameterName>
                    <dataType>VARCHAR</dataType>
                </parameter>
            </Prepared_Param_DataType>
            <jdbcSharedConfig>/SharedResource/Connection/Jdbc/BTCTDB.sharedjdbc</jdbcSharedConfig>
        </config>
        <pd:inputBindings>
            <jdbcUpdateActivityInput>
                <SENT_TO_T24>
                    <xsl:value-of select="$_globalVariables/ns2:GlobalVariables/ServiceGlobalVar/BTCTPosting/RecordDB_T24Failed"/>
                </SENT_TO_T24>
                <ERR_MSG>
                    <xsl:value-of select="concat(&quot;Indicator : &quot; ,$BTCTUpdateSchema/pfx5:BTCTUpdate/pfx5:successIndicator   ,&quot;T24 Msg : &quot; , $BTCTUpdateSchema/pfx5:BTCTUpdate/pfx5:messages , &quot;---Service Msg : &quot; ,$ServiceResponse/ServiceResponse/Err_msg)"/>
                </ERR_MSG>
                <CHUTRI_REF>
                    <xsl:choose>
                        <xsl:when test="exists($BTCTUpdateSchema/pfx5:BTCTUpdate/pfx5:CHUTRI_REF)">
                            <xsl:value-of select="$BTCTUpdateSchema/pfx5:BTCTUpdate/pfx5:CHUTRI_REF"/>
                        </xsl:when>
                        <xsl:otherwise>
                            <xsl:attribute name="xsi:nil">true</xsl:attribute>
                        </xsl:otherwise>
                    </xsl:choose>
                </CHUTRI_REF>
                <SENT_TO_T24_NEW>
                    <xsl:value-of select="$_globalVariables/ns2:GlobalVariables/ServiceGlobalVar/BTCTPosting/RecordDB_T24New"/>
                </SENT_TO_T24_NEW>
            </jdbcUpdateActivityInput>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="UpdateSchema">
        <pd:type>com.tibco.pe.core.AssignActivity</pd:type>
        <pd:resourceType>ae.activities.assignActivity</pd:resourceType>
        <pd:x>940</pd:x>
        <pd:y>397</pd:y>
        <config>
            <variableName>BTCTUpdateSchema</variableName>
        </config>
        <pd:inputBindings>
            <pfx5:BTCTUpdate>
                <pfx5:CHUTRI_REF>
                    <xsl:value-of select="$Start/root/pfx2:ServiceEnverlop/ServiceBody/ns1:RequestBody/ns1:CHUTRI_REF[1]"/>
                </pfx5:CHUTRI_REF>
                <xsl:if test="$Map-ESB-Model/pfx3:BTCT_Posting_Model/pfx3:TTBTDT_DATA/pfx3:NGAY">
                    <pfx5:NGAY>
                        <xsl:value-of select="$Map-ESB-Model/pfx3:BTCT_Posting_Model/pfx3:TTBTDT_DATA/pfx3:NGAY"/>
                    </pfx5:NGAY>
                </xsl:if>
                <xsl:if test="$Map-ESB-Model/pfx3:BTCT_Posting_Model/pfx3:TTBTDT_DATA/pfx3:PHIEN">
                    <pfx5:PHIEN>
                        <xsl:value-of select="$Map-ESB-Model/pfx3:BTCT_Posting_Model/pfx3:TTBTDT_DATA/pfx3:PHIEN"/>
                    </pfx5:PHIEN>
                </xsl:if>
                <xsl:if test="$PostToT24_SettleTTBT/outputMessage/pfx4:SettleTTBTResponse/Status/transactionId">
                    <pfx5:transactionId>
                        <xsl:value-of select="$PostToT24_SettleTTBT/outputMessage/pfx4:SettleTTBTResponse/Status/transactionId"/>
                    </pfx5:transactionId>
                </xsl:if>
                <xsl:if test="$PostToT24_SettleTTBT/outputMessage/pfx4:SettleTTBTResponse/Status/successIndicator">
                    <pfx5:successIndicator>
                        <xsl:value-of select="$PostToT24_SettleTTBT/outputMessage/pfx4:SettleTTBTResponse/Status/successIndicator"/>
                    </pfx5:successIndicator>
                </xsl:if>
                <pfx5:messages>
                    <xsl:value-of select="$PostToT24_SettleTTBT/outputMessage/pfx4:SettleTTBTResponse/Status/messages[1]"/>
                </pfx5:messages>
                <xsl:if test="$PostToT24_SettleTTBT/outputMessage/pfx4:SettleTTBTResponse/SBVFTLVBULKType/FTGENERATELSTAT">
                    <pfx5:FTGENERATELSTAT>
                        <xsl:value-of select="$PostToT24_SettleTTBT/outputMessage/pfx4:SettleTTBTResponse/SBVFTLVBULKType/FTGENERATELSTAT"/>
                    </pfx5:FTGENERATELSTAT>
                </xsl:if>
                <xsl:if test="$Start/root/pfx2:ServiceEnverlop/ServiceBody/ns1:RequestBody/ns1:CHUTRI_REF[1]">
                    <pfx5:Unique_ID>
                        <xsl:value-of select="$Start/root/pfx2:ServiceEnverlop/ServiceBody/ns1:RequestBody/ns1:CHUTRI_REF[1]"/>
                    </pfx5:Unique_ID>
                </xsl:if>
            </pfx5:BTCTUpdate>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="SR-QueryError">
        <pd:type>com.tibco.pe.core.AssignActivity</pd:type>
        <pd:resourceType>ae.activities.assignActivity</pd:resourceType>
        <pd:x>517</pd:x>
        <pd:y>51</pd:y>
        <config>
            <variableName>ServiceResponse</variableName>
        </config>
        <pd:coercions>
            <pd:coercion xpath="$Start/root/pfx2:ServiceEnverlop/ServiceBody/*" element="ns1:RequestBody"/>
        </pd:coercions>
        <pd:inputBindings>
            <ServiceResponse>
                <Status>
                    <xsl:value-of select="1"/>
                </Status>
                <Err_msg>
                    <xsl:value-of select="concat(&quot;Cannot Query BTCT DB : &quot; , $_error/ns3:ErrorReport/Msg)"/>
                </Err_msg>
                <pfx11:ServiceResponse>
                    <pfx11:Status>
                        <xsl:value-of select="4"/>
                    </pfx11:Status>
                    <pfx11:ErrorMessage>
                        <xsl:value-of select="concat( &quot;Error BTCT DB. Msg : &quot;, $_error/ns3:ErrorReport/Msg)"/>
                    </pfx11:ErrorMessage>
                    <pfx11:NotifyMsg>
                        <xsl:value-of select="concat( &quot;Error BTCT DB. Msg : &quot;, $_error/ns3:ErrorReport/Msg)"/>
                    </pfx11:NotifyMsg>
                    <pfx11:ErrorExist>
                        <xsl:value-of select="&quot;true&quot;"/>
                    </pfx11:ErrorExist>
                    <xsl:if test="$Start/root/pfx2:ServiceEnverlop/ServiceBody/ns1:RequestBody[1]/ns1:CHUTRI_REF[1]">
                        <pfx11:Unique_ID>
                            <xsl:value-of select="$Start/root/pfx2:ServiceEnverlop/ServiceBody/ns1:RequestBody[1]/ns1:CHUTRI_REF[1]"/>
                        </pfx11:Unique_ID>
                    </xsl:if>
                    <xsl:if test="$ServiceResponse/ServiceResponse/pfx11:ServiceResponse/pfx11:timestamps">
                        <pfx11:timestamps>
                            <xsl:value-of select="$ServiceResponse/ServiceResponse/pfx11:ServiceResponse/pfx11:timestamps"/>
                        </pfx11:timestamps>
                    </xsl:if>
                </pfx11:ServiceResponse>
            </ServiceResponse>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="Assign-UpdateSchema-1">
        <pd:type>com.tibco.pe.core.AssignActivity</pd:type>
        <pd:resourceType>ae.activities.assignActivity</pd:resourceType>
        <pd:x>826</pd:x>
        <pd:y>207</pd:y>
        <config>
            <variableName>BTCTUpdateSchema</variableName>
        </config>
        <pd:inputBindings>
            <pfx5:BTCTUpdate>
                <xsl:if test="$Start/root/pfx2:ServiceEnverlop/ServiceBody/ns1:RequestBody/ns1:CHUTRI_REF[1]">
                    <pfx5:CHUTRI_REF>
                        <xsl:value-of select="$Start/root/pfx2:ServiceEnverlop/ServiceBody/ns1:RequestBody/ns1:CHUTRI_REF[1]"/>
                    </pfx5:CHUTRI_REF>
                </xsl:if>
                <xsl:if test="$Map-ESB-Model/pfx3:BTCT_Posting_Model/pfx3:TTBTDT_DATA/pfx3:NGAY">
                    <pfx5:NGAY>
                        <xsl:value-of select="$Map-ESB-Model/pfx3:BTCT_Posting_Model/pfx3:TTBTDT_DATA/pfx3:NGAY"/>
                    </pfx5:NGAY>
                </xsl:if>
                <xsl:if test="$Map-ESB-Model/pfx3:BTCT_Posting_Model/pfx3:TTBTDT_DATA/pfx3:PHIEN">
                    <pfx5:PHIEN>
                        <xsl:value-of select="$Map-ESB-Model/pfx3:BTCT_Posting_Model/pfx3:TTBTDT_DATA/pfx3:PHIEN"/>
                    </pfx5:PHIEN>
                </xsl:if>
                <pfx5:successIndicator>
                    <xsl:value-of select="&quot;Call T24WS Error&quot;"/>
                </pfx5:successIndicator>
                <pfx5:messages>
                    <xsl:value-of select="$_error/ns3:ErrorReport/Msg"/>
                </pfx5:messages>
                <xsl:if test="$Start/root/pfx2:ServiceEnverlop/ServiceBody/ns1:RequestBody/ns1:CHUTRI_REF[1]">
                    <pfx5:Unique_ID>
                        <xsl:value-of select="$Start/root/pfx2:ServiceEnverlop/ServiceBody/ns1:RequestBody/ns1:CHUTRI_REF[1]"/>
                    </pfx5:Unique_ID>
                </xsl:if>
            </pfx5:BTCTUpdate>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="SR-CallT24WSError-UpdateFailed">
        <pd:type>com.tibco.pe.core.AssignActivity</pd:type>
        <pd:resourceType>ae.activities.assignActivity</pd:resourceType>
        <pd:x>1263</pd:x>
        <pd:y>132</pd:y>
        <config>
            <variableName>ServiceResponse</variableName>
        </config>
        <pd:inputBindings>
            <ServiceResponse>
                <Status>
                    <xsl:value-of select="1"/>
                </Status>
                <Err_msg>
                    <xsl:value-of select="concat(&quot; T24Error + UpdateDB Error : &quot; , $_error/ns3:ErrorReport/Msg)"/>
                </Err_msg>
                <pfx11:ServiceResponse>
                    <pfx11:Status>
                        <xsl:value-of select="5"/>
                    </pfx11:Status>
                    <pfx11:ErrorMessage>
                        <xsl:value-of select="concat( &quot; CallT24WSError and UpdateFailed . Msg : &quot; , $_error/ns3:ErrorReport/Msg)"/>
                    </pfx11:ErrorMessage>
                    <pfx11:NotifyMsg>
                        <xsl:value-of select="concat( &quot; CallT24WSError and UpdateFailed . Msg : &quot; , $_error/ns3:ErrorReport/Msg)"/>
                    </pfx11:NotifyMsg>
                    <pfx11:ErrorExist>
                        <xsl:value-of select="&quot;true&quot;"/>
                    </pfx11:ErrorExist>
                    <xsl:if test="$Start/root/pfx2:ServiceEnverlop/ServiceBody/ns1:RequestBody/ns1:CHUTRI_REF[1]">
                        <pfx11:Unique_ID>
                            <xsl:value-of select="$Start/root/pfx2:ServiceEnverlop/ServiceBody/ns1:RequestBody/ns1:CHUTRI_REF[1]"/>
                        </pfx11:Unique_ID>
                    </xsl:if>
                    <xsl:if test="$ServiceResponse/ServiceResponse/pfx11:ServiceResponse/pfx11:timestamps">
                        <pfx11:timestamps>
                            <xsl:value-of select="$ServiceResponse/ServiceResponse/pfx11:ServiceResponse/pfx11:timestamps"/>
                        </pfx11:timestamps>
                    </xsl:if>
                </pfx11:ServiceResponse>
            </ServiceResponse>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="SR-LogicError-UpdateFailed">
        <pd:type>com.tibco.pe.core.AssignActivity</pd:type>
        <pd:resourceType>ae.activities.assignActivity</pd:resourceType>
        <pd:x>1263</pd:x>
        <pd:y>216</pd:y>
        <config>
            <variableName>ServiceResponse</variableName>
        </config>
        <pd:inputBindings>
            <ServiceResponse>
                <Status>
                    <xsl:value-of select="1"/>
                </Status>
                <Err_msg>
                    <xsl:value-of select="concat(&quot;T24 Failed  Msg : :&quot;, $BTCTUpdateSchema/pfx5:BTCTUpdate/pfx5:messages,'; Update DB Error MSG:', $_error/ns3:ErrorReport/Msg)"/>
                </Err_msg>
                <pfx11:ServiceResponse>
                    <pfx11:Status>
                        <xsl:value-of select="6"/>
                    </pfx11:Status>
                    <pfx11:ErrorMessage>
                        <xsl:value-of select="concat( &quot;Logic Error - UpdateDB Failed. Msg : &quot;, $_error/ns3:ErrorReport/Msg)"/>
                    </pfx11:ErrorMessage>
                    <pfx11:NotifyMsg>
                        <xsl:value-of select="concat( &quot;Logic Error - UpdateDB Failed. Msg : &quot;, $_error/ns3:ErrorReport/Msg)"/>
                    </pfx11:NotifyMsg>
                    <pfx11:ErrorExist>
                        <xsl:value-of select="&quot;true&quot;"/>
                    </pfx11:ErrorExist>
                    <xsl:if test="$Start/root/pfx2:ServiceEnverlop/ServiceBody/ns1:RequestBody/ns1:CHUTRI_REF[1]">
                        <pfx11:Unique_ID>
                            <xsl:value-of select="$Start/root/pfx2:ServiceEnverlop/ServiceBody/ns1:RequestBody/ns1:CHUTRI_REF[1]"/>
                        </pfx11:Unique_ID>
                    </xsl:if>
                    <xsl:if test="$ServiceResponse/ServiceResponse/pfx11:ServiceResponse/pfx11:timestamps">
                        <pfx11:timestamps>
                            <xsl:value-of select="$ServiceResponse/ServiceResponse/pfx11:ServiceResponse/pfx11:timestamps"/>
                        </pfx11:timestamps>
                    </xsl:if>
                </pfx11:ServiceResponse>
            </ServiceResponse>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="SR-T24Success_T24Exist-UpdateFailed">
        <pd:type>com.tibco.pe.core.AssignActivity</pd:type>
        <pd:resourceType>ae.activities.assignActivity</pd:resourceType>
        <pd:x>1249</pd:x>
        <pd:y>641</pd:y>
        <config>
            <variableName>ServiceResponse</variableName>
        </config>
        <pd:inputBindings>
            <ServiceResponse>
                <Status>
                    <xsl:value-of select="1"/>
                </Status>
                <Err_msg>
                    <xsl:value-of select="concat(&quot;T24 Success + Update Error :  &quot; , $_error/ns3:ErrorReport/Msg)"/>
                </Err_msg>
                <pfx11:ServiceResponse>
                    <pfx11:Status>
                        <xsl:value-of select="8"/>
                    </pfx11:Status>
                    <pfx11:ErrorMessage>
                        <xsl:value-of select="concat( &quot;T24Success/T24Exist-UpdateFailed. Msg : &quot;, $_error/ns3:ErrorReport/Msg)"/>
                    </pfx11:ErrorMessage>
                    <pfx11:NotifyMsg>
                        <xsl:value-of select="concat( &quot;T24Success/T24Exist-UpdateFailed. Msg : &quot;, $_error/ns3:ErrorReport/Msg)"/>
                    </pfx11:NotifyMsg>
                    <pfx11:ErrorExist>
                        <xsl:value-of select="&quot;true&quot;"/>
                    </pfx11:ErrorExist>
                    <xsl:if test="$Start/root/pfx2:ServiceEnverlop/ServiceBody/ns1:RequestBody/ns1:CHUTRI_REF[1]">
                        <pfx11:Unique_ID>
                            <xsl:value-of select="$Start/root/pfx2:ServiceEnverlop/ServiceBody/ns1:RequestBody/ns1:CHUTRI_REF[1]"/>
                        </pfx11:Unique_ID>
                    </xsl:if>
                    <xsl:if test="$ServiceResponse/ServiceResponse/pfx11:ServiceResponse/pfx11:timestamps">
                        <pfx11:timestamps>
                            <xsl:value-of select="$ServiceResponse/ServiceResponse/pfx11:ServiceResponse/pfx11:timestamps"/>
                        </pfx11:timestamps>
                    </xsl:if>
                </pfx11:ServiceResponse>
            </ServiceResponse>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="AsignLoopVar">
        <pd:type>com.tibco.pe.core.AssignActivity</pd:type>
        <pd:resourceType>ae.activities.assignActivity</pd:resourceType>
        <pd:x>361</pd:x>
        <pd:y>141</pd:y>
        <config>
            <variableName>ReadError</variableName>
        </config>
        <pd:inputBindings>
            <Input>
                <ReadError>
                    <xsl:value-of select="'false'"/>
                </ReadError>
                <RowsCount>
                    <xsl:value-of select="count($GetBTCTData/resultSet/Record)"/>
                </RowsCount>
            </Input>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="SR-init">
        <pd:type>com.tibco.pe.core.AssignActivity</pd:type>
        <pd:resourceType>ae.activities.assignActivity</pd:resourceType>
        <pd:x>226</pd:x>
        <pd:y>50</pd:y>
        <config>
            <variableName>ServiceResponse</variableName>
        </config>
        <pd:coercions>
            <pd:coercion xpath="$Start/root/pfx2:ServiceEnverlop/ServiceBody/*" element="ns1:RequestBody"/>
        </pd:coercions>
        <pd:inputBindings>
            <ServiceResponse>
                <Status>
                    <xsl:value-of select="0"/>
                </Status>
                <pfx11:ServiceResponse>
                    <pfx11:Status>
                        <xsl:value-of select="0"/>
                    </pfx11:Status>
                    <pfx11:ErrorExist>
                        <xsl:value-of select="&quot;false&quot;"/>
                    </pfx11:ErrorExist>
                    <pfx11:timestamps>
                        <xsl:value-of select="tib:timestamp()"/>
                    </pfx11:timestamps>
                </pfx11:ServiceResponse>
            </ServiceResponse>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="SR-MapError">
        <pd:type>com.tibco.pe.core.AssignActivity</pd:type>
        <pd:resourceType>ae.activities.assignActivity</pd:resourceType>
        <pd:x>704</pd:x>
        <pd:y>203</pd:y>
        <config>
            <variableName>ServiceResponse</variableName>
        </config>
        <pd:coercions>
            <pd:coercion xpath="$Start/root/pfx2:ServiceEnverlop/ServiceBody/*" element="ns1:RequestBody"/>
        </pd:coercions>
        <pd:inputBindings>
            <ServiceResponse>
                <Status>
                    <xsl:value-of select="1"/>
                </Status>
                <Err_msg>
                    <xsl:value-of select="concat(&quot;Cannot Query BTCT DB : &quot; , $_error/ns3:ErrorReport/Msg)"/>
                </Err_msg>
                <pfx11:ServiceResponse>
                    <pfx11:Status>
                        <xsl:value-of select="3"/>
                    </pfx11:Status>
                    <pfx11:ErrorMessage>
                        <xsl:value-of select="concat( &quot;Map Error. Msg : &quot;, $_error/ns3:ErrorReport/Msg)"/>
                    </pfx11:ErrorMessage>
                    <pfx11:NotifyMsg>
                        <xsl:value-of select="concat( &quot;Map Error. Msg : &quot;, $_error/ns3:ErrorReport/Msg)"/>
                    </pfx11:NotifyMsg>
                    <pfx11:ErrorExist>
                        <xsl:value-of select="&quot;true&quot;"/>
                    </pfx11:ErrorExist>
                    <xsl:if test="$Start/root/pfx2:ServiceEnverlop/ServiceBody/ns1:RequestBody[1]/ns1:CHUTRI_REF[1]">
                        <pfx11:Unique_ID>
                            <xsl:value-of select="$Start/root/pfx2:ServiceEnverlop/ServiceBody/ns1:RequestBody[1]/ns1:CHUTRI_REF[1]"/>
                        </pfx11:Unique_ID>
                    </xsl:if>
                    <xsl:if test="$ServiceResponse/ServiceResponse/pfx11:ServiceResponse/pfx11:timestamps">
                        <pfx11:timestamps>
                            <xsl:value-of select="$ServiceResponse/ServiceResponse/pfx11:ServiceResponse/pfx11:timestamps"/>
                        </pfx11:timestamps>
                    </xsl:if>
                </pfx11:ServiceResponse>
            </ServiceResponse>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="Goto End">
        <pd:type>com.tibco.plugin.timer.NullActivity</pd:type>
        <pd:resourceType>ae.activities.null</pd:resourceType>
        <pd:x>707</pd:x>
        <pd:y>50</pd:y>
        <config/>
        <pd:inputBindings/>
    </pd:activity>
    <pd:activity name="SR-T24Success_T24Exist-UpdateSuccess">
        <pd:type>com.tibco.pe.core.AssignActivity</pd:type>
        <pd:resourceType>ae.activities.assignActivity</pd:resourceType>
        <pd:x>1369</pd:x>
        <pd:y>478</pd:y>
        <config>
            <variableName>ServiceResponse</variableName>
        </config>
        <pd:inputBindings>
            <ServiceResponse>
                <Status>
                    <xsl:value-of select="if (($BTCTUpdateSchema/pfx5:BTCTUpdate/pfx5:successIndicator=&quot;Success&quot;) and ($BTCTUpdateSchema/pfx5:BTCTUpdate/pfx5:FTGENERATELSTAT='PROCESSED')&#xA;or ($BTCTUpdateSchema/pfx5:BTCTUpdate/pfx5:successIndicator = &quot;T24Error&quot; ) and contains($BTCTUpdateSchema/pfx5:BTCTUpdate/pfx5:messages[1] , &quot;ALREADY ASSIGNED&quot;  )) &#xA;then 0&#xA;else 1"/>
                </Status>
                <Err_msg>
                    <xsl:value-of select="$BTCTUpdateSchema/pfx5:BTCTUpdate/pfx5:messages"/>
                </Err_msg>
                <pfx11:ServiceResponse>
                    <pfx11:Status>
                        <xsl:value-of select="0"/>
                    </pfx11:Status>
                    <pfx11:ErrorMessage>
                        <xsl:value-of select="concat( &quot;T24 Success. ID : &quot; , $BTCTUpdateSchema/pfx5:BTCTUpdate/pfx5:transactionId)"/>
                    </pfx11:ErrorMessage>
                    <pfx11:ErrorExist>
                        <xsl:value-of select="&quot;false&quot;"/>
                    </pfx11:ErrorExist>
                    <xsl:if test="$Start/root/pfx2:ServiceEnverlop/ServiceBody/ns1:RequestBody/ns1:CHUTRI_REF[1]">
                        <pfx11:Unique_ID>
                            <xsl:value-of select="$Start/root/pfx2:ServiceEnverlop/ServiceBody/ns1:RequestBody/ns1:CHUTRI_REF[1]"/>
                        </pfx11:Unique_ID>
                    </xsl:if>
                    <xsl:if test="$ServiceResponse/ServiceResponse/pfx11:ServiceResponse/pfx11:timestamps">
                        <pfx11:timestamps>
                            <xsl:value-of select="$ServiceResponse/ServiceResponse/pfx11:ServiceResponse/pfx11:timestamps"/>
                        </pfx11:timestamps>
                    </xsl:if>
                </pfx11:ServiceResponse>
            </ServiceResponse>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="SR-NoLineToInsert">
        <pd:type>com.tibco.pe.core.AssignActivity</pd:type>
        <pd:resourceType>ae.activities.assignActivity</pd:resourceType>
        <pd:x>608</pd:x>
        <pd:y>148</pd:y>
        <config>
            <variableName>ServiceResponse</variableName>
        </config>
        <pd:inputBindings>
            <ServiceResponse>
                <Status>
                    <xsl:value-of select="1"/>
                </Status>
                <Err_msg>
                    <xsl:value-of select="concat(&quot; No input line BTCT : &quot; , $_error/ns3:ErrorReport/Msg)"/>
                </Err_msg>
                <pfx11:ServiceResponse>
                    <pfx11:Status>
                        <xsl:value-of select="9"/>
                    </pfx11:Status>
                    <pfx11:ErrorMessage>
                        <xsl:value-of select="concat(&quot; No input line BTCT : &quot; , $_error/ns3:ErrorReport/Msg)"/>
                    </pfx11:ErrorMessage>
                    <pfx11:NotifyMsg>
                        <xsl:value-of select="concat(&quot; No input line BTCT : &quot; , $_error/ns3:ErrorReport/Msg)"/>
                    </pfx11:NotifyMsg>
                    <pfx11:ErrorExist>
                        <xsl:value-of select="&quot;true&quot;"/>
                    </pfx11:ErrorExist>
                    <xsl:if test="$Start/root/pfx2:ServiceEnverlop/ServiceBody/ns1:RequestBody/ns1:CHUTRI_REF[1]">
                        <pfx11:Unique_ID>
                            <xsl:value-of select="$Start/root/pfx2:ServiceEnverlop/ServiceBody/ns1:RequestBody/ns1:CHUTRI_REF[1]"/>
                        </pfx11:Unique_ID>
                    </xsl:if>
                    <xsl:if test="$ServiceResponse/ServiceResponse/pfx11:ServiceResponse/pfx11:timestamps">
                        <pfx11:timestamps>
                            <xsl:value-of select="$ServiceResponse/ServiceResponse/pfx11:ServiceResponse/pfx11:timestamps"/>
                        </pfx11:timestamps>
                    </xsl:if>
                </pfx11:ServiceResponse>
            </ServiceResponse>
        </pd:inputBindings>
    </pd:activity>
    <pd:transition>
        <pd:from>Start</pd:from>
        <pd:to>SR-init</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>Loop Handling Record</pd:from>
        <pd:to>Map-to-T24-Request</pd:to>
        <pd:xpathDescription>success</pd:xpathDescription>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>xpath</pd:conditionType>
        <pd:xpath>( count($ListNettingResult/ListNettingResult/pfx7:mIBPSREF) &gt; 0 ) and ($ReadError/Input/ReadError = 'false' )</pd:xpath>
    </pd:transition>
    <pd:transition>
        <pd:from>Catch</pd:from>
        <pd:to>Sleep</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>Sleep</pd:from>
        <pd:to>errorProcessor-Unexpected</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>errorProcessor-Unexpected</pd:from>
        <pd:to>End</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>Map-to-T24-Request</pd:from>
        <pd:to>PostToT24_SettleTTBT</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>UpdateSchema</pd:from>
        <pd:to>UpdateSuccess</pd:to>
        <pd:xpathDescription>Update Success</pd:xpathDescription>
        <pd:lineType>Multiple Bends</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>xpath</pd:conditionType>
        <pd:xpath>($BTCTUpdateSchema/pfx5:BTCTUpdate/pfx5:successIndicator="Success") and ($BTCTUpdateSchema/pfx5:BTCTUpdate/pfx5:FTGENERATELSTAT='PROCESSED')</pd:xpath>
    </pd:transition>
    <pd:transition>
        <pd:from>PostToT24_SettleTTBT</pd:from>
        <pd:to>UpdateSchema</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>UpdateSchema</pd:from>
        <pd:to>UpdateLogicError</pd:to>
        <pd:xpathDescription>Logic Error</pd:xpathDescription>
        <pd:lineType>Multiple Bends</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>xpath</pd:conditionType>
        <pd:xpath>($BTCTUpdateSchema/pfx5:BTCTUpdate/pfx5:FTGENERATELSTAT = "FAILED" ) or ( ($BTCTUpdateSchema/pfx5:BTCTUpdate/pfx5:successIndicator = "T24Error" ) and not(contains($BTCTUpdateSchema/pfx5:BTCTUpdate/pfx5:messages[1] , "ALREADY ASSIGNED")) )</pd:xpath>
    </pd:transition>
    <pd:transition>
        <pd:from>UpdateSchema</pd:from>
        <pd:to>UpdateExistStatus</pd:to>
        <pd:xpathDescription>Update Exist</pd:xpathDescription>
        <pd:lineType>Multiple Bends</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>xpath</pd:conditionType>
        <pd:xpath>($BTCTUpdateSchema/pfx5:BTCTUpdate/pfx5:successIndicator = "T24Error" ) and contains($BTCTUpdateSchema/pfx5:BTCTUpdate/pfx5:messages[1] , "ALREADY ASSIGNED"  )</pd:xpath>
    </pd:transition>
    <pd:transition>
        <pd:from>UpdateSchema</pd:from>
        <pd:to>UpdateErrorOnly</pd:to>
        <pd:xpathDescription>Update Error Technical</pd:xpathDescription>
        <pd:lineType>Multiple Bends</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>xpath</pd:conditionType>
        <pd:xpath>$BTCTUpdateSchema/pfx5:BTCTUpdate/pfx5:successIndicator =  "TWSError"</pd:xpath>
    </pd:transition>
    <pd:transition>
        <pd:from>UpdateSuccess</pd:from>
        <pd:to>SR-T24Success_T24Exist-UpdateSuccess</pd:to>
        <pd:lineType>Multiple Bends</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>UpdateLogicError</pd:from>
        <pd:to>SR-UpdateDB Success</pd:to>
        <pd:lineType>Multiple Bends</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>UpdateExistStatus</pd:from>
        <pd:to>SR-T24Success_T24Exist-UpdateSuccess</pd:to>
        <pd:lineType>Multiple Bends</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>UpdateErrorOnly</pd:from>
        <pd:to>SR-UpdateDB Success</pd:to>
        <pd:xpathDescription/>
        <pd:lineType>Multiple Bends</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>SR-UpdateDB Success</pd:from>
        <pd:to>End</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>GetBTCTData</pd:from>
        <pd:to>SR-QueryError</pd:to>
        <pd:xpathDescription>Error</pd:xpathDescription>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>error</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>SR-QueryError</pd:from>
        <pd:to>Goto End</pd:to>
        <pd:xpathDescription>GotoEnd</pd:xpathDescription>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>PostToT24_SettleTTBT</pd:from>
        <pd:to>Assign-UpdateSchema-1</pd:to>
        <pd:xpathDescription>Error</pd:xpathDescription>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>error</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>Assign-UpdateSchema-1</pd:from>
        <pd:to>UpdateErrorOnly</pd:to>
        <pd:xpathDescription>UpdateErrorOnly</pd:xpathDescription>
        <pd:lineType>One Bend</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>SR-CallT24WSError-UpdateFailed</pd:from>
        <pd:to>End</pd:to>
        <pd:lineType>One Bend</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>SR-LogicError-UpdateFailed</pd:from>
        <pd:to>End</pd:to>
        <pd:lineType>One Bend</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>UpdateErrorOnly</pd:from>
        <pd:to>SR-CallT24WSError-UpdateFailed</pd:to>
        <pd:xpathDescription>Error</pd:xpathDescription>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>error</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>UpdateLogicError</pd:from>
        <pd:to>SR-LogicError-UpdateFailed</pd:to>
        <pd:xpathDescription>Error</pd:xpathDescription>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>error</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>UpdateSuccess</pd:from>
        <pd:to>SR-T24Success_T24Exist-UpdateFailed</pd:to>
        <pd:xpathDescription>Error</pd:xpathDescription>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>error</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>SR-T24Success_T24Exist-UpdateFailed</pd:from>
        <pd:to>End</pd:to>
        <pd:lineType>One Bend</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>GetBTCTData</pd:from>
        <pd:to>AsignLoopVar</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>AsignLoopVar</pd:from>
        <pd:to>Loop Handling Record</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>UpdateExistStatus</pd:from>
        <pd:to>SR-T24Success_T24Exist-UpdateFailed</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>error</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>SR-init</pd:from>
        <pd:to>GetBTCTData</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>Map-to-T24-Request</pd:from>
        <pd:to>SR-MapError</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>error</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>SR-MapError</pd:from>
        <pd:to>Goto End</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>Goto End</pd:from>
        <pd:to>End</pd:to>
        <pd:lineType>One Bend</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>Loop Handling Record</pd:from>
        <pd:to>SR-NoLineToInsert</pd:to>
        <pd:xpathDescription>No Line - GotoEnd</pd:xpathDescription>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>xpath</pd:conditionType>
        <pd:xpath>( count($ListNettingResult/ListNettingResult/pfx7:mIBPSREF) = 0 ) or (  $ReadError/Input/ReadError = 'true' )</pd:xpath>
    </pd:transition>
    <pd:transition>
        <pd:from>SR-T24Success_T24Exist-UpdateSuccess</pd:from>
        <pd:to>End</pd:to>
        <pd:lineType>One Bend</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>SR-NoLineToInsert</pd:from>
        <pd:to>Goto End</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
</pd:ProcessDefinition>